---
title: Animate interactive objects with Face Detection, JavaScript and Chrome Browser
author: Bryan Shalloway
date: '2020-07-20'
slug: animate-interactive-objects-with-face-detection-javascript-and-chrome-browser
categories:
  - visu
  - javascript
tags:
  - javascript
  - chrome
  - api
  - animation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
```


We spend the majority of our time in front of screens. It's mostly one of computer/tablet/phone/tv^[Maybe there's also Peloton, car display, Mirror... (if you're fancy).]. These are primarily on platforms the user controls or owns. However I'm surprised we don't yet have more interactions with screens "out in the world". 

Face detection and object recognition technologies are now highly accessible, making it easy to create interactive screens. I wanted to toy around with using this technology to create displays that are designed to surprise or startle the user^[This is not a new idea.]. In this post I'll describe my starting place on a small project.

# Things follow you

Try to recall that creepy feeling you get when someone or something is looking at you. Now imagine having that feeling all of the time. That is the surprise or unsettled feeling I want to evoke. A few examples:

A poster for a new Lord of the Rings movie coming out that has an Eye of Sauron that follows you as you walk into the cinema^[Similarly, picture a portrait whose eyes follow you as you walk-by -- similar to Mark Rober's [video] (https://www.youtube.com/watch?v=sPgKu2E-jdw) but tracking you automatically (human free).]. 

![](https://i.insider.com/5aec114a19ee861f008b4855?width=1200&format=jpeg&auto=webp)

An army recruiter with an "I want you" Uncle Sam  poster behind him whose finger points at you as you walk by.

![](https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Unclesamwantyou.jpg/440px-Unclesamwantyou.jpg)

or imagine bumping into someone at the grocery store during COVID19 whose shirt beeps at you and flashes red if you get within 6 feet of them.

I intentionally made these examples somewhat dystopian. There is an important societal reckoning taking place right now regarding tracking technologies (particularly in regard to their impacts on communities of color). I wanted to work on something that, while playful, would call to mind concerns of a 'Big Brother' or 'watchful eye' like figure.

As a starting place, I focused on *animating eyes* that would track a user that looked at them (and requiring just a browser and a webcam).

# First draft

Here is my first pass:

__video of it in action__

The [code is on codepen](https://codepen.io/brshallo/full/qBbyrLg)6[This is my first project using JavaScript (don't expect much when it comes to code quality).]. 

To set it up:

* Open a Chrome browser and go [here](chrome://flags/#enable-experimental-web-platform-features) and enable experimental web platform features (it currently only works on Chrome and only on Windows or macOS -- it does not yet work on Android, iOS, or Linux)
* Go to [codepen link](https://codepen.io/brshallo/full/qBbyrLg)
* Allow use of webcam when prompted and ensure you are in the 'Results' view and within view of your webcam (you can press F11 key to go full screen and hide the browser bar)
* You will likely need to hit refresh when opening or when resizing

If you want to use it to creep out the family members you are locked at home with, see the [Additional actions] section.

## How I made this

To get the video and initial face detection set-up, I copied code from [this repo](https://github.com/wesbos/beginner-javascript/tree/764f0d589e6affeda2c0b6f17874311188de0d57/exercises/55%20-%20Face%20Detection%20Censorship) by [Wes Bos](https://twitter.com/wesbos). To animate the eye, I used an html5 canvas element and javascript. Mostly, the eye follows your position in the video. Though I did a few things to make the eye movement look more interesting:

* Rather than updating with every frame, it estimates your position based on the moving average of 10 frames, this makes the movement appear more smooth and softens the jitters that come from the algorithm constantly updating it's estimate of your position
* I used some trigonometry to soften the tracking so that the pupil's movement would look more realistic at a distance. 
* I also have the components of the eye slightly change shape and turn in or out depending on your position. However this is very much still a work on progress (there are errors and most of the math here is almost nonsensical) -- fixing the eye tracking is the major focus area for [Next steps].

# Next steps

**Improve position mapping:**

Using estimates of the length of facial landmarks, you can estimate the distance someone is from the screen. See [project on github](https://github.com/philiiiiiipp/Android-Screen-to-Face-Distance-Measurement) that discusses this^[For my use-case though I may use face height rather than (or in addition to) face width -- as cannot trust that people will be turned towards my camera and figure it is less likely they will tilt their head.]. Once you have an estimate of someone's position, you can adjust the image accordingly so that you can make the eye look like it is following the user through space^[Though may be somewhat limited as a user has two eyes, not just one, so depth illusion might not work perfectly.]. Here is a 'back of the napkin' sketch of my mental model for the problem:

__Photo of diagram of eye and required trig__

Once you have an estimate of the distance a face is from the camera, the important points for the projection of the eye to a 2d animation can be filled-in (with just a little bit of trigonometry). Ultimately I'd love to do something like was set-up [here](https://github.com/evermeer/EVFaceTracker):

![](https://github.com/evermeer/EVFaceTracker/raw/master/EVFaceTracker.gif?raw=true)

Or picture a digital version (tailored to where the user is standing) of the creepy alligator meme that was going around:

![](http://www.ohmagif.com/wp-content/uploads/2013/12/cool-amazing-t-rex-optical-illusion.gif)

Though this may be limited^[Afterall, we're not working with holograms or special glasses.]. Also, note this means the view would be tailored to a single user -- the animation would become distorted for users other than the individual the animation is tracking.

**Improve everything else:**

Animating the above would require a great deal more sophistication. I'd also love to improve the code. However, the above [Next steps] are largely aspirational -- this project is *far removed* from my day job and I am inexperienced in much of the underlying technologies / softwares^[So doing things goes slowly.]. Hence I'm unsure when I'll pick this back-up^[But wanted to at least post this first draft].

# Path, Learning, and Resources

My initial plan for building the tracking eyes was to use the python bindings for OpenCV^[Open Computer Vision] for the face detection and then use the open source video editing software, *Blender* (which can also run python scripts), to overlay an animation. See [cool example](https://www.youtube.com/watch?v=O7nNO3FLkLU) where someone uses Blender to demo face animations of a character. A problem with this approach is that Blender is not a light-weight application. Hence I wasn't sure how I would easily deploy it... so investigated alternatives.

On the tail-end of [this presentation](https://www.youtube.com/watch?v=8p5SDI4TNDc) by [Cassie Evans](https://twitter.com/cassiecodes?lang=en) on making interactive SVG images, is where I learned about Google Chrome's experimental shape detection API. I then found [Wes Bos' tweet](https://twitter.com/wesbos/status/976097163834019842?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E976097163834019842%7Ctwgr%5E&ref_url=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Ftype%3Dtext2Fhtmlkey%3Da19fcc184b9711e1b4764040d3dc5c07schema%3Dtwitterurl%3Dhttps3A%2F%2Ftwitter.com%2Fwesbos%2Fstatus%2F976097163834019842image%3Dhttps3A%2F%2Fi.embed.ly%2F1%2Fimage3Furl3Dhttps253A252F252Fpbs.twimg.com252Fmedia252FDYvLKKMXkAAUxjf.jpg253Alarge26key3Da19fcc184b9711e1b4764040d3dc5c07) on the subject:

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">ðŸ˜® Did you know Chrome has a FaceDetector API? <a href="https://t.co/wSwDdI8p1u">pic.twitter.com/wSwDdI8p1u</a></p>&mdash; Wes Bos (@wesbos) <a href="https://twitter.com/wesbos/status/976097163834019842?ref_src=twsrc%5Etfw">March 20, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

Given the relative simplicity of the shape detection API and the ease with which I could then deploy a first draft through a Chrome browser, I decided to go this route. 

*A problem* was that I needed to learn some web development (or at least JavaScript) basics. *Preliminary learning resources I went through:*

* About 40% of the videos/exercies from the first three courses of [University of Michigan's Web Design series on coursera](https://www.coursera.org/specializations/web-design#courses) by [Colleen van Lent ](https://twitter.com/ColleenAtUMSI)
* The first several chapters of [Learn to Code HTML & CSS](https://learn.shayhowe.com/html-css/building-your-first-web-page/) by [Shay Howe](https://twitter.com/shayhowe)
* Some [tutorials on HTML5 canvas](https://www.youtube.com/watch?v=EO6OkltgudE&list=PLpPnRKq7eNW3We9VdCfx9fprhqXHwTPXL) elements by [Chris Courses](https://twitter.com/chriscourses?lang=en)

Rather than taking the SVG route, I ended-up just using a canvas element. WARNING, this is my first project in JavaScript... please don't judge me based on the code quality `!r emo::ji('smile')`.

# Closing thoughts

Please try it out or consider ways you can make something engaging or surprising for users. If you do, please let me know :-) [@brshallo](https://twitter.com/brshallo).

# Appendix

## Additional actions

* Ensure there is *very good* frontward facing lighting (though tracking currently gets jumpy at a distance^[Perhaps will fix / improve in future.])
* Plug device into a TV or larger display 
* Get the camera lined-up
* Call your loved one into the room and wait for them to notice and start interacting with the giant eye ball that is following them
* For *bonus* points capture it on video and tweet it at me or with an appropriate hashtag (e.g. #eyeseeyou)
* For *bonus* bonus points, edit the code and make some fun new animation from it
